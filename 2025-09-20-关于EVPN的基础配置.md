---
title: 关于EVPN的基础配置
author: Izumi
date: 2025-09-20
---

# 关于EVPN的基础配置

## 概述

> **定义**
>
> EVPN（Ethernet Virtual Private Network）是下一代全业务承载的VPN解决方案。EVPN统一了各种VPN业务的控制面，利用BGP扩展协议来传递二层或三层的可达性信息，实现了转发面和控制面的分离。

## 具体配置

### 配置普通EVPN功能

#### 网络整体规划

* 物理信息规划表

  | Local Device | Local Interface | Remote Device | Remote Interface |
  | ------------ | --------------- | ------------- | ---------------- |
  | NE-1         | GE3/0/8         | NE-3          | GE3/0/0          |
  | -            | GE3/0/9         | NE-2          | GE3/0/0          |
  | NE-2         | GE3/0/0         | PC-1          | GE1/0/0          |
  | -            | GE3/0/9         | NE-1          | GE3/0/9          |
  | NE-3         | GE3/0/0         | PC-2          | GE1/0/0          |
  | -            | GE3/0/9         | NE-1          | GE3/0/8          |
  | PC-1         | GE1/0/0         | NE-2          | GE3/0/9          |
  | PC-2         | GE1/0/0         | NE-3          | GE3/0/9          |

* 逻辑信息规划表

  | Device | Interface | IP Address      |
  | ------ | --------- | --------------- |
  | NE-1   | GE3/0/8   | 10.1.0.5/30     |
  | -      | GE3/0/9   | 10.1.0.1/30     |
  | -      | Loopback0 | 10.0.0.1/32     |
  | NE-2   | GE3/0/0   | 10.1.0.2/30     |
  | -      | Loopback0 | 10.0.0.2/32     |
  | NE-3   | GE3/0/0   | 10.1.0.6/30     |
  | -      | Loopback0 | 10.0.0.3/32     |
  | PC-1   | GE1/0/0   | 192.168.10.1/24 |
  | PC-2   | GE1/0/0   | 192.168.10.2/24 |

* IS-IS规划表

  | Device | ISIS Process | NET                       | Interface                   |
  | ------ | ------------ | ------------------------- | --------------------------- |
  | NE-1   | 1            | 49.0001.0100.0000.0001.00 | GE3/0/8, GE3/0/9, Loopback0 |
  | NE-2   | 1            | 49.0001.0100.0000.0002.00 | GE3/0/0, Loopback0          |
  | NE-3   | 1            | 49.0001.0100.0000.0003.00 | GE3/0/0, Loopback0          |

* MPLS LDP规划表

  | Device | LSR-id   | Interface      |
  | ------ | -------- | -------------- |
  | NE-1   | 10.0.0.1 | G3/0/9, G3/0/8 |
  | NE-2   | 10.0.0.2 | G3/0/0         |
  | NE-3   | 10.0.0.3 | G3/0/0         |

* EVPN规划表

  | Device | EVPN Source | EVPN Instance | RD       | ERT   | IRT   | Binding Interface |
  | ------ | ----------- | ------------- | -------- | ----- | ----- | ----------------- |
  | NE-2   | 10.0.0.2    | EVPN_A        | 65000:10 | 10:10 | 10:10 | GE3/0/9           |
  | NE-3   | 10.0.0.3    | EVPN_A        | 65000:10 | 10:10 | 10:10 | GE3/0/9           |

* BGP规划表

  | Device | BGP AS | Peer     |
  | ------ | ------ | -------- |
  | NE-2   | 65000  | 10.0.0.3 |
  | NE-3   | 65000  | 10.0.0.2 |

#### 具体配置步骤

##### 配置设备基础信息

* NE-1

  ```
  sy
  int g3/0/8
  ip add 10.1.0.5 30
  int g3/0/9
  ip add 10.1.0.1 30
  int l0
  ip add 10.0.0.1 32
  commit
  ```

* NE-2

  ```
  sy
  int g3/0/0
  ip add 10.1.0.2 30
  int l0
  ip add 10.0.0.2 32
  commit
  ```

* NE-3

  ```
  sy
  int g3/0/0
  ip add 10.1.0.6 30
  int l0
  ip add 10.0.0.3 32
  commit
  ```

* PC-1和PC-2配置略

##### 配置ISIS

* NE-1

  ```
  sy
  isis 1
  net 49.0001.0100.0000.0001.00
  int g3/0/8
  isis e 1
  int g3/0/9
  isis e 1
  int l0
  isis e 1
  commit
  ```

* NE-2

  ```
  sy
  isis 1
  net 49.0001.0100.0000.0002.00
  int g3/0/0
  isis e 1
  int l0
  isis e 1
  commit
  ```

* NE-3

  ```
  sy
  isis 1
  net 49.0001.0100.0000.0003.00
  int g3/0/0
  isis e 1
  int l0
  isis e 1
  commit
  ```

##### 配置MPLS LDP

* NE-1

  ```
  sy
  mpls lsr 10.0.0.1
  mpls
  mpls lsr
  int g3/0/9
  mpls
  mpls lsr
  commit
  ```

* NE-2

  ```
  sy
  mpls lsr 10.0.0.2
  mpls
  mpls lsr
  int g3/0/9
  mpls
  mpls lsr
  commit
  ```

* NE-3

  ```
  sy
  mpls lsr 10.0.0.3
  mpls
  mpls lsr
  int g3/0/9
  mpls
  mpls lsr
  commit
  ```

##### 配置EVPN

* NE-2

  ```
  sy
  evpn vpn-instance EVPN_A
  route-distinguisher 65000:10
  vpn-target 10:10
  evpn source-address 10.0.0.2
  interface g3/0/9
  evpn binding vpn-instance EVPN_A
  commit
  ```

* NE-3

  ```
  sy
  evpn vpn-instance EVPN_A
  route-distinguisher 65000:10
  vpn-target 10:10
  evpn source-address 10.0.0.3
  interface g3/0/9
  evpn binding vpn-instance EVPN_A
  commit
  ```

##### 配置BGP

* NE-2

  ```
  sy
  bgp 65000
  pe 10.0.0.3 as 65000
  pe 10.0.0.3 con l0
  l2vpn-family evpn
  pe 10.0.0.3 en
  y
  commit
  ```

* NE-3

  ```
  sy
  bgp 65000
  pe 10.0.0.2 as 65000
  pe 10.0.0.2 con l0
  l2vpn-family evpn
  pe 10.0.0.2 en
  y
  commit
  ```
  

#### 结果验证

* 使用`display default-parameter evpn`命令查看EVPN初始化时的各项缺省配置信息。
* 使用`display evpn vpn-instance [ name vpn-instance-name ]`命令查看EVPN实例信息。
* 使用`display evpn vpn-instance name vpn-instance-name df result [ esi esi ]`命令查看EVPN实例的DF选举结果。
* 使用`display evpn vpn-instance name vpn-instance-name df-timer state`命令查看EVPN实例DF定时器状态。
* 使用`display bgp evpn { all | vpn-instance vpn-instance-name } esi [ esi ]`命令查看EVPN实例的ESI信息。
* 使用`display bgp evpn { all | route-distinguisher route-distinguisher | vpn-instance vpn-instance-name } routing-table [ { ad-route | es-route | inclusive-route | mac-route | prefix-route } prefix ]`命令查看BGP EVPN的路由信息。
* 使用`display bgp evpn all routing-table statistics`命令查看BGP EVPN的路由统计信息。
* 使用`display evpn mac routing-table`命令查看EVPN实例的MAC路由信息。
* 使用`display evpn mac routing-table limit`命令查看EVPN实例中MAC地址的限制信息。
* 使用`display evpn mac routing-table statistics`命令查看EVPN实例的MAC路由的统计信息。
* 使用`display arp broadcast-suppress user bridge-domain bd-id`命令查看指定BD域的ARP广播抑制表。
* 使用`display arp packet statistics bridge-domain bd-id`命令查看指定BD域的ARP报文的统计信息。

### 配置BD EVPN功能

#### 网络整体规划

* 物理信息规划表

  | Local Device | Local Interface | Remote Device | Remote Interface |
  | ------------ | --------------- | ------------- | ---------------- |
  | NE-1         | GE3/0/8         | NE-3          | GE3/0/0          |
  | -            | GE3/0/9         | NE-2          | GE3/0/0          |
  | NE-2         | GE3/0/0         | PC-1          | GE1/0/0          |
  | -            | GE3/0/9         | NE-1          | GE3/0/9          |
  | NE-3         | GE3/0/0         | PC-2          | GE1/0/0          |
  | -            | GE3/0/9         | NE-1          | GE3/0/8          |
  | PC-1         | GE1/0/0         | NE-2          | GE3/0/9          |
  | PC-2         | GE1/0/0         | NE-3          | GE3/0/9          |

* 逻辑信息规划表

  | Device | Interface | IP Address      |
  | ------ | --------- | --------------- |
  | NE-1   | GE3/0/8   | 10.1.0.5/30     |
  | -      | GE3/0/9   | 10.1.0.1/30     |
  | -      | Loopback0 | 10.0.0.1/32     |
  | NE-2   | GE3/0/0   | 10.1.0.2/30     |
  | -      | Loopback0 | 10.0.0.2/32     |
  | NE-3   | GE3/0/0   | 10.1.0.6/30     |
  | -      | Loopback0 | 10.0.0.3/32     |
  | PC-1   | GE1/0/0   | 192.168.10.1/24 |
  | PC-2   | GE1/0/0   | 192.168.10.2/24 |

* IS-IS规划表

  | Device | ISIS Process | NET                       | Interface                   |
  | ------ | ------------ | ------------------------- | --------------------------- |
  | NE-1   | 1            | 49.0001.0100.0000.0001.00 | GE3/0/8, GE3/0/9, Loopback0 |
  | NE-2   | 1            | 49.0001.0100.0000.0002.00 | GE3/0/0, Loopback0          |
  | NE-3   | 1            | 49.0001.0100.0000.0003.00 | GE3/0/0, Loopback0          |

* MPLS LDP规划表

  | Device | LSR-id   | Interface      |
  | ------ | -------- | -------------- |
  | NE-1   | 10.0.0.1 | G3/0/9, G3/0/8 |
  | NE-2   | 10.0.0.2 | G3/0/0         |
  | NE-3   | 10.0.0.3 | G3/0/0         |

* EVPN规划表

  | Device | EVPN Source | EVPN Instance | RD       | ERT   | IRT   |
  | ------ | ----------- | ------------- | -------- | ----- | ----- |
  | NE-2   | 10.0.0.2    | EVPN_A        | 65000:10 | 10:10 | 10:10 |
  | NE-3   | 10.0.0.3    | EVPN_A        | 65000:10 | 10:10 | 10:10 |

* BD规划表

  | Device | Bridge Domain | Binding Interface | Binding EVPN |
  | ------ | ------------- | ----------------- | ------------ |
  | NE-2   | 10.0.0.2      | GE3/0/9.10        | EVPN_A       |
  | NE-3   | 10.0.0.3      | GE3/0/9.10        | EVPN_A       |

* BGP规划表

  | Device | BGP AS | Peer     |
  | ------ | ------ | -------- |
  | NE-2   | 65000  | 10.0.0.3 |
  | NE-3   | 65000  | 10.0.0.2 |

#### 具体配置步骤

##### 配置设备基础信息

* NE-1

  ```
  sy
  int g3/0/8
  ip add 10.1.0.5 30
  int g3/0/9
  ip add 10.1.0.1 30
  int l0
  ip add 10.0.0.1 32
  commit
  ```

* NE-2

  ```
  sy
  int g3/0/0
  ip add 10.1.0.2 30
  int l0
  ip add 10.0.0.2 32
  commit
  ```

* NE-3

  ```
  sy
  int g3/0/0
  ip add 10.1.0.3 30
  int l0
  ip add 10.0.0.3 32
  commit
  ```

* PC-1和PC-2配置略

##### 配置ISIS

* NE-1

  ```
  sy
  isis 1
  net 49.0001.0100.0000.0001.00
  int g3/0/8
  isis e 1
  int g3/0/9
  isis e 1
  int l0
  isis e 1
  commit
  ```

* NE-2

  ```
  sy
  isis 1
  net 49.0001.0100.0000.0002.00
  int g3/0/0
  isis e 1
  int l0
  isis e 1
  commit
  ```

* NE-3

  ```
  sy
  isis 1
  net 49.0001.0100.0000.0003.00
  int g3/0/0
  isis e 1
  int l0
  isis e 1
  commit
  ```

##### 配置MPLS LDP

* NE-1

  ```
  sy
  mpls lsr 10.0.0.1
  mpls
  mpls lsr
  int g3/0/9
  mpls
  mpls lsr
  commit
  ```

* NE-2

  ```
  sy
  mpls lsr 10.0.0.2
  mpls
  mpls lsr
  int g3/0/9
  mpls
  mpls lsr
  commit
  ```

* NE-3

  ```
  sy
  mpls lsr 10.0.0.3
  mpls
  mpls lsr
  int g3/0/9
  mpls
  mpls lsr
  commit
  ```

##### 配置EVPN

* NE-2

  ```
  sy
  evpn vpn-instance EVPN_A
  route-distinguisher 65000:10
  vpn-target 10:10
  evpn source-address 10.0.0.2
  commit
  ```

* NE-3

  ```
  sy
  evpn vpn-instance EVPN_A
  route-distinguisher 65000:10
  vpn-target 10:10
  evpn source-address 10.0.0.3
  commit
  ```

##### 配置BD

* NE-2

  ```
  sy
  bridge-domain 10
  evpn bind EVPN_A
  int g3/0/9.10 mode l2
  encap untag
  bridge-domain 10
  commit
  ```

* NE-3

  ```
  sy
  bridge-domain 10
  evpn bind EVPN_A
  int g3/0/9.10 mode l2
  encap untag
  bridge-domain 10
  commit
  ```

##### 配置BGP

* NE-2

  ```
  sy
  bgp 65000
  pe 10.0.0.3 as 65000
  pe 10.0.0.3 con l0
  l2vpn-family evpn
  pe 10.0.0.3 en
  commit
  ```

* NE-3

  ```
  sy
  bgp 65000
  pe 10.0.0.2 as 65000
  pe 10.0.0.2 con l0
  l2vpn-family evpn
  pe 10.0.0.2 en
  commit
  ```

#### 结果验证

* 使用`display default-parameter evpn`命令查看EVPN初始化时的各项缺省配置信息。
* 使用`display evpn vpn-instance [ name vpn-instance-name ]`命令查看EVPN实例信息。
* 使用`display evpn vpn-instance name vpn-instance-name df result [ esi esi ]`命令查看EVPN实例的DF选举结果。
* 使用`display evpn vpn-instance name vpn-instance-name df-timer state`命令查看EVPN实例DF定时器状态。
* 使用`display bgp evpn { all | vpn-instance vpn-instance-name } esi [ esi ]`命令查看EVPN实例的ESI信息。
* 使用`display bgp evpn { all | route-distinguisher route-distinguisher | vpn-instance vpn-instance-name } routing-table [ { ad-route | es-route | inclusive-route | mac-route | prefix-route } prefix ]`命令查看BGP EVPN的路由信息。
* 使用`display bgp evpn all routing-table statistics`命令查看BGP EVPN的路由统计信息。
* 使用`display evpn mac routing-table`命令查看EVPN实例的MAC路由信息。
* 使用`display evpn mac routing-table limit`命令查看EVPN实例中MAC地址的限制信息。
* 使用`display evpn mac routing-table statistics`命令查看EVPN实例的MAC路由的统计信息。
* 使用`display arp broadcast-suppress user bridge-domain bd-id`命令查看指定BD域的ARP广播抑制表。
* 使用`display arp packet statistics bridge-domain bd-id`命令查看指定BD域的ARP报文的统计信息。

